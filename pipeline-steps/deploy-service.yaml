parameters:
  environment: ''
  location: ''
  stack: ''
  project: ''
  tfversion: ''
  activity_name: ''
  serviceConnection: ''
  gaServiceConnection: ''
  run_stage: ''
  databaseName: ''
  serverName: ''
  resourceGroupName: ''
  synapseWorkspaceName: ''
  postPlanScript: []

steps:

  - template: keyvault-read.yaml
    parameters:
      serviceConnection: $(serviceConnection)
      environment: ${{ parameters.environment }}

# lowercase $env variable comes from the above template

  - task: Bash@3
    displayName: 'Subscription Replacement'
    inputs:
      targetType: 'inline'
      workingDirectory: '$(System.DefaultWorkingDirectory)/scritps/'
      script: |
            ls -lrt
  - ${{each inputScript in parameters.postPlanScript}}:
    - scripts: 'echo ${{ inputScript.file  }}'
      parameters:
      - ${{each parameter in inputScript.parameters}}:
        - ${{ parameter.name  }}: ${{ parameter.value  }}

  